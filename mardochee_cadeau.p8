pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--main

function _init()
    car:init()
    enemie:init()
    focus_camera:init(car.x, car.y)
end

function _update60()
    car:update()
    enemie:update()
    focus_camera:update(car.x, car.y)
end

function _draw()
    cls(13)
    map(0,0)
    car:draw()
    enemie:draw()
    focus_camera:draw()
end

-->8
--tools
function is_solid(edge,obj,offx,offy,flags,debug)
	local col_list={}
	offx_=offx
	offy_=offy
	flags_=flags or {0}
	if(type(flags_)!="table") flags_={flags}
	local ix=obj.x+obj.offx+offx_ --the x collision pixel
	local iy=obj.y+obj.offy+offy_ --the y collision pixel
	for x=ix,ix+obj.width+7,8 do
		for y=iy,iy+obj.heigth+7,8 do
			if edge==nil
			or edge=="full"
			or (edge=="up" and y==iy)
			or (edge=="down" and y>=iy+obj.heigth)
			or (edge=="left" and x==ix)
			or (edge=="right" and x>=ix+obj.width)
			then
				add(col_list, {x=min(x,ix+obj.width), y=min(y,iy+obj.heigth)})
			end
		end
	end
	if(debug) print(#col_list)
	for c in all(col_list) do 
		if(debug) pset(c.x, c.y, 8)
		for v in all(flags_) do
			if(fget(mget(c.x/8, c.y/8),v)) return true
		end
	end
	return false
end

focus_camera = {
    init=function(this, focx, focy)
        this.x = 0
        this.y = 0
        this.focus_x=focx or 0
        this.focus_y=focy or 0

    end,

    update=function(this, focx, focy)
        this.x=this.x + (focx - this.x)/20
        this.y=this.y + (focy - this.y)/20
    end,

    draw=function(this)
        camera(this.x-64, this.y-64)
    end
}   

-->8
--car

car={
    init=function(self)
        self.spr=1
        self.x=15*8
        self.y=15*8
        self.offx=0
        self.offy=0
        self.width=6
        self.heigth=6
        self.angle=0
        self.vecx=0
        self.vecy=0
        
        self.direction_x=self.x
        self.direction_y=self.y
        self.direction_angle=90
        self.direction_radius=10
        self.anim_delta=0
        self.anim_bool=false
		self.dx=0
		self.dy=0

    end,

    update=function(self)

		self.dx=0
        self.dy=0

        if(btn(⬅️)) self.dx=-1; self.spr=17
        if(btn(➡️)) self.dx+=1; self.spr=2
        if(btn(⬆️)) self.dy=-1; self.spr=1
        if(btn(⬇️)) self.dy+=1; self.spr=18

        if not(is_solid("full",self,self.dx,0,{1})) then self.x+=self.dx end
        if not(is_solid("full",self,0,self.dy,{1})) then self.y+=self.dy end

        if(btnp(❎)) then
            self.anim_bool=true
        end

        if self.anim_bool==true then
            self.anim_delta+=1
            if self.anim_delta==7 then 
                self.anim_bool=false
                self.anim_delta=0
            end
        end
    end,

    draw=function(self)
        spr(self.spr, self.x, self.y)
        spr(41+self.anim_delta, self.x+(8*self.dx), self.y+(8*self.dy))
    end
}

-->8
--enemie

enemie={
    init=function(self)
        self.spr=34
        self.x=15*8
        self.y=15*8
        self.delta=0
        self.vecx=0
        self.vecy=0
        right = true
    end,

    update=function(self)

        self.vecx=car.x-self.x
        self.vecy=car.y-self.y
        self.x+=self.vecx/100
        self.y+=self.vecy/100

    end,

    draw=function(self)
        spr(self.spr, self.x, self.y)
    end
}

__gfx__
000000000000000000001000044aa4405555555533333333dddddddd444444446666666666666666000000000000000000000000000000000000000000000000
00000000000110000001410044933a445555555533333333dddddddd444444446666116666116666070000000770000000000000000000000000000000000000
007007000014410000017710493373a45555555533333333dddddddd444444446661a71111a71666000000000777000000070000000000000000000000000000
000770000174471000017441933b773a5555555533333333dddddddd444444446661aa8888aa1666000000000077000000777000000000000000000000000000
000770001477774100017441933bb33a5555555533333333dddddddd444444446661888888881666000000000000000000077000000070700000000000000000
007007000111111000017710493333a45555555533333333dddddddd444444446611885555881166000000000000000000000700000007700000000000000000
00000000000000000001410044933a445555555533333333dddddddd444444446151885555881516000000000000000000000070000077700000007000000000
000000000000000000001000044994405555555533333333dddddddd444444446611485555841166000000000000000000000000000000000000000000000000
7777777700010000000000003333333333333333cccccccc99999999aaaaaaaa6661485555841666000000000000000000000000000000000000000000000000
70000007001410000000000033333333333bbb33cccccccc99999999aaaaaaaa6661485555841666000000000000000000000000000000000000000000000000
7000000701771000011111103333333333b33333cccccccc99999999aaaaaaaa6661225555221666000000000000000000000000000000000000000000000000
7000000714471000147777413333333333333333cccccccc99999999aaaaaaaa6661225555221666000000000000000000000000000000000000000000000000
7000000714471000017447103333333333333333cccccccc99999999aaaaaaaa6611226666221166000000000000000000000000000000000000000000000000
0000000001771000001441003333333333333333cccccccc99999999aaaaaaaa6151226666221516000000000000000000000000000000000000000000000000
000000000014100000011000333bab3333333333cccccccc99999999aaaaaaaa661122eeee221166000000000000000000000000000000000000000000000000
0000000000010000000000003333b33333333333cccccccc99999999aaaaaaaa6666111111116666000000000000000000000000000000000000000000000000
000000000000000000006000344aa443667766776666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
00000000000660000006760044933a44666666666666666666666666000000000000000000000000070000000770000000000000000000000000000000000000
000000000067760000069960493373a4666666666666666666666666000000000000000000000000000000000777000000070000000000000000000000000000
000000000697796000069776933b773a666666666666666666666666000000000000000000000000000000000077000000777000000000000000000000000000
000000006799997600069776933bb33a666666666666666666666666000000000000000000000000000000000000000000077000000070700000000000000000
000000000666666000069960493333a4666666666666666666666666000000000000000000000000000000000000000000000700000007700000000000000000
00000000000000000006760044933a44666666666666666666666666000000000000000000000000000000000000000000000070000077700000007000000000
00000000000000000000600034499443666666666677667766666666000000000000000000000000000000000000000000000000000000000000000000000000
00000000000600000000000000000000666666677666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006760000000000000000000666666677666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000069960000666666000000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000677960006799997600000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000677960000697796000000000666666677666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000069960000067760000000000666666677666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006760000006600000000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000600000000000000000000666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050504000435360000040404000000000000000000000404060404000608090606071616151515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050315050504000435360000000000000000000000000000060606060606060608191606071616161515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050504000435360606060606060606060606060606060606060606060604353607161616151515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050504150504000435252525252525252525252525252525252525252525252525253606071616151515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050504000624242424242424242424242424242424242424242424242424262606071616161515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050504000000000000000000000000000000000000000000000000000000060606071616151515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50504150505050504000000000000000000000000000000000000000000000000000000060607161616151515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050315050504040404040404040404040404040404040404040404040404040404040404071616151515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050505050505050505050505050505050505050505050507171717171717171717161616151515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050505050505050505050505050505050503150505050506161616161616161616161616161515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050505050505050505050505050505050415050505050505151615151515151615151516161515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050505050505050505050505050503150505050505050505151516151515151615151515151615151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505031505050504150504150505050505050505050505050505050505151515151515151515151515151515151515151515151515151515151515100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050505050505050505050505050505050505031505050505151515151515151515151515151515151515151515151515151515151515151510000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050505050505050505050505050505050505050505050505151515151515151515151515151515151515151515151515151515151515151510000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000005151515151515151515151515151515151515151515151515151515151515151510000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000005151515151515151515151515151515151515151515151515151515151515151510000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000005151515151515151515151515151515151515151515151515151515151515151510000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000005151515151515151515151515151515151515151515151515151515151515151510000
__gff__
0000000202000000020200000000000000000000000200000202000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0505050505050505050505050505050505050505050505050505051405151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505051305050505050505151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505130505050505050513050505050505050505151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050513130505130505050505050505050505050505050505151515151615151515161515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505051405050513050505050514050505050514050513050505050505151515161515151516151615151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505140505161616161616161616161616161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505171717171717171717161616161615151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050513040404040404040404040404040404040404040404040404040404040404171616161616151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040000000000000000000000000000000000000000000000000000060606171616161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505051405040026252525252525252525252525252525252525252525252525252606061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034352424242424242424242424242424242424242424242424343506061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350606060606060606060606060606060606060606060606343506061716161615151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505130505050505040034350600000000000000000000000000060406060406060406343506171616161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350600000000000000000000000000060606060606060606343506061716161615151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350610001000100404040000000000000000000000060606343506061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0513050505050505040034350600000000000404040000000000000000000000060406343506061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0513050505050505040034350610001000100404040000000000000000000000060606343506061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050513050505040034350600000006000404040000000000000000000000060606343506061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350606000603060007070707070707070707070000060406343506061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050514140505040034350603060006000007050505050505050514070000060606343506171616161615151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350606000006000007051423051305230505070000060606343506061716161516151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350606000603060007051313050514050505070000060406343506061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505130505040008090603060606000007051313050514050514070000060606343506061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505140505050505040018190606000006000007050505230505050505070000060606343506061716161515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505140505050505040034350606000603060007050514051305230505070000060406343506061716161615151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350603060006000007050505050505050505070000060606343506061716161516161515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350606000006000007070707070707070707070000000006343506061716161515151515151515151515151515151515150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350606000603060000000000000000000000000604040006343506061716161615151515151515151515151515151515150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505130505141405040034350603060006000000000000000000000004040604040006343506061716161515151515151515151515151515151515150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505130505050505040034350606000404040000000000000000000006060606060606343506171616161515151515151515151515151515151515150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505040034350600000404040000000000000000000004040604040006343506061716161515151515151515151515151515151515150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
